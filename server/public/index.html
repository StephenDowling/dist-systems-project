<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="mystyle.css">
</head>
<body>

<h1>Shopping Cart</h1>
<p>Welcome to the shopping cart!</p>
<p>Please select from the services below: </p>
<div id="cartService" class="container">
  <ul id="items"></ul>
<form id="form" action="/addToCart" method="post">
  <input id="inputName" name="itemName" autocomplete="off" placeholder="Item Name" required />
  <input id="inputPrice" name="itemPrice" autocomplete="off" placeholder="Price" required />

  <button id="submitButton" type="button">Add</button><!-- Note: type="button" to prevent default form submission -->
</form>
<form id="removeForm" action="/removeFromCart" method="delete">
  <input id="removeInputName" name="itemName" autocomplete="off" placeholder="Item Name" required />

  <button id="removeButton" type="button">Remove</button> <!-- Note: type="button" to prevent default form submission -->
</form>
  <div class="vertical-center">
    <!-- Add an ID to the button for easier reference -->
    <button id="totalValuebutton" type="button" name="add">Total Value</button>
    <button id="applyDiscountbutton" type="button" name="add">Apply Discount</button>
  </div>
<form id="paymentForm" action="/processPayment" method="delete">
  <input id="cardNo" name="cardNo" autocomplete="off" placeholder="Card Number" required />

  <button id="paymentButton" type="button">Pay Now</button> <!-- Note: type="button" to prevent default form submission -->
</form>
</div>

<div id="queryService" class="container">
  <form id = "priceLookUp" class="" action="/priceLookUp" method="get">
    <input id="priceLookUpInput" name="itemName" autocomplete="off" placeholder="Item Name" required />
    <div id="priceMessage"></div>
    <button id="priceLookUpButton" type="button">Look up price</button>
  </form>
  <form id = "findProduct" class="" action="/findProduct" method="get">
    <input id="findProductInput" name="itemName" autocomplete="off" placeholder="Item Name" required />
    <div id="location"></div>
    <button id="findProductButton" type="button">Find Product</button>
  </form>

</div>
<div id="data-container">
  <ul id="allergyList"></ul>
  <button id="startStreamButton">Start Stream</button>
  <div id="result"></div>
</div>

<script>
const ws = new WebSocket('ws://localhost:4000');

// Handle WebSocket open event
ws.onmessage = function(event) {
const resultDiv = document.getElementById('result');
try {
  const jsonData = JSON.parse(event.data);
  console.log('Received JSON data:', jsonData);
  // Update the UI with the parsed JSON data
  resultDiv.textContent = JSON.stringify(jsonData); // Display JSON data as a string
} catch (error) {
  console.error('Error parsing JSON data:', error);
}
};

    // Function to send a message to start the stream
    function startStream() {
      // Send a message to the server to start the stream
      ws.send('startStream');
    }

    // Attach click event listener to the button
    document.getElementById('startStreamButton').addEventListener('click', startStream);
  // Add event listener to the button
var totalValueButton = document.getElementById('totalValuebutton');
var applyDiscountbutton = document.getElementById('applyDiscountbutton');
totalValueButton.addEventListener('click', function() {
          // Change the window location to the desired URL
          window.location.href = 'http://localhost:3000/totalValue';
      });
applyDiscountbutton.addEventListener('click', function() {
          // Change the window location to the desired URL
          window.location.href = 'http://localhost:3000/applyDiscount';
      });
//add to cart function
document.getElementById('submitButton').addEventListener('click', function(event) {
           event.preventDefault(); // Prevent default form submission behavior
           const itemName = document.getElementById('inputName').value;
           const itemPrice = document.getElementById('inputPrice').value;

           // Ensure both itemName and itemPrice are provided
           if (itemName && itemPrice) {
              // Send the form data to the server using fetch or another method
              fetch('/addToCart', {
                 method: 'POST',
                 headers: {
                    'Content-Type': 'application/json'
                 },
                 body: JSON.stringify({
                    itemName: itemName,
                    itemPrice: itemPrice
                 })
              })
              .then(response => {
                 // Handle response from server
                 if (response.ok) {
                    // Handle success
                    console.log('Item added to cart successfully');
                 } else {
                    // Handle error
                    console.error('Failed to add item to cart');
                    console.log(response)
                    console.log(response.ok)
                 }
              })
              .catch(error => {
                 // Handle network errors
                 console.error('Error:', error);
              });
           } else {
              // Inform user to fill in both item name and price
              console.error('Please fill in both item name and price');
           }
        });
//remove from cart function
document.getElementById('removeButton').addEventListener('click', function(event) {
   event.preventDefault(); // Prevent default form submission behavior
   const itemName = document.getElementById('removeInputName').value;

   // Ensure both itemName and itemPrice are provided
   if (itemName) {
      // Send the form data to the server using fetch or another method
      fetch('/removeFromCart', {
         method: 'DELETE',
         headers: {
            'Content-Type': 'application/json'
         },
         body: JSON.stringify({
            itemName: itemName
         })
      })
      .then(response => {
         // Handle response from server
         if (response.ok) {
            // Handle success
            console.log('Item removed from cart successfully');
         } else {
            // Handle error
            console.error('Failed to remove item from cart');
         }
      })
      .catch(error => {
         // Handle network errors
         console.error('Error:', error);
      });
   } else {
      // Inform user to fill in both item name and price
      console.error('Please fill in item name');
   }
});
//process payment function
document.getElementById('paymentButton').addEventListener('click', function(event) {
   event.preventDefault(); // Prevent default form submission behavior
   const cardNo = document.getElementById('cardNo').value;

   // Ensure both itemName and itemPrice are provided
   if (cardNo) {
      // Send the form data to the server using fetch or another method
      fetch('/processPayment', {
         method: 'DELETE',
         headers: {
            'Content-Type': 'application/json'
         },
         body: JSON.stringify({
            cardNo: cardNo
         })
      })
      .then(response => {
         // Handle response from server
         if (response.ok) {
            // Handle success
            console.log('Payment processed');
         } else {
            // Handle error
            console.error('Failed to process payment');
         }
      })
      .catch(error => {
         // Handle network errors
         console.error('Error:', error);
      });
   } else {
      // Inform user to fill in both item name and price
      console.error('Please enter card number');
   }
});
document.getElementById('priceLookUpButton').addEventListener('click', function(event) {
   event.preventDefault(); // Prevent default form submission behavior
   const itemName = document.getElementById('priceLookUpInput').value;

   // Ensure itemName is provided
   if (itemName) {
      // Send the form data to the server using fetch or another method
      fetch(`/priceLookUp?itemName=${encodeURIComponent(itemName)}`, {
         method: 'GET',
         headers: {
            'Content-Type': 'application/json'
         },
      })
      .then(response => {
         // Handle response from server
         if (response.ok) {
            // Parse response JSON
            return response.json();
         } else {
            // Handle error
            console.error('Failed to find price');
         }
      })
      .then(data => {
         // Display the price message on the browser
         document.getElementById('priceMessage').innerText = data.priceMsg;
      })
      .catch(error => {
         // Handle network errors
         console.error('Error:', error);
      });
   } else {
      // Inform user to fill in both item name and price
      console.error('Please enter item name');
   }

});
document.getElementById('findProductButton').addEventListener('click', function(event) {
   event.preventDefault(); // Prevent default form submission behavior
   const itemName = document.getElementById('findProductInput').value;

   // Ensure itemName is provided
   if (itemName) {
      // Send the form data to the server using fetch or another method
      fetch(`/findProduct?itemName=${encodeURIComponent(itemName)}`, {
         method: 'GET',
         headers: {
            'Content-Type': 'application/json'
         },
      })
      .then(response => {
         // Handle response from server
         if (response.ok) {
            // Parse response JSON
            return response.json();
         } else {
            // Handle error
            console.error('Failed to find product');
         }
      })
      .then(data => {
         // Display the price message on the browser
         document.getElementById('location').innerText = data.location;
      })
      .catch(error => {
         // Handle network errors
         console.error('Error:', error);
      });
   } else {
      // Inform user to fill in both item name and price
      console.error('Please enter item name');
   }

});


</script>

</body>
</html>
